= Design: {project-name}

:imagesdir: images

Vorname Nachname <email@domain.org>; Vorname2 Nachname2 <email2@domain.org>; Vorname3 Nachname3 <email3@domain.org>
{localdatetime}
include::../_includes/default-attributes.inc.adoc[]
// Platzhalter für weitere Dokumenten-Attribute


== Allgemeine Informationen
Dieses Dokument enthält Modelle/Beschreibungen zu diskreten Entwurfsentscheidungen, die aus einzelnen Use-Cases und den Konzepten des Architecture-Notebooks hervorgehen.

== Technische Designaspekte
Technische Designaspekte beschreiben Entwurfsentscheidungen, die direkten Einfluss auf die Funktionsweise einzelner Systemkomponenten haben.

=== Datenbankmodell vom Terminal

Pilotendaten und das Protokoll, sowie die verfügbaren RFID-Auweise werden in einer Datenbank gehalten. Es ergeben sich so genau 3 relationale Tabellen, die miteinander in Beziehung stehen und diese Objekte repräsentieren. Jeder Pilot wird eindeutig über einen RFID-Ausweis identifiziert, somit besteht eine 1:c-Beziehung zwischen den entsprechenden Tabellen (Es kann mehr hinterlegte RFID-Ausweise als Piloten geben, daher die konditionale Beziehung). Das Protokoll wird als eine Menge von Flugsessions dargestellt, von denen jeder Pilot mehrere haben kann.

.Datenbankmodell vom Terminal 
image::Datenmodell_Terminal.png[Datenbankmodell, width=70%, align="center"]

=== Datenbankmodell vom Webserver

Zu den 3 relationalen Tabellen vom Terminal, kommt beim Datenbankmodell vom Webserver noch eine Gasttabelle hinzu. Sie steht mit der Menge von Flugsessions (dem Protokoll) in einer nc:c beziehung.
So kann ein Pilot in einer Flugsession entweder einen oder keinen Gast haben,  und eine Flugsession könnte keinen, einen oder mehrere Gäste beinhalten. 
Für den Login am Webserver wurden in der Tabelle Pilot außerdem noch drei zusätzlichen Spalten (Nutzername, Passwort, Ist_Admin) hinzugefügt. 

.Datenbankmodell vom Webserver
image::Datenmodell.png[Datenbankmodell, width=70%, align="center"]


=== Synchronisation
Da sich die Datenhaltung auf dem Webserver und am Terminal unabhängig voneinander ändern kann, ist es notwendig bei einem periodisch Abgleichen der Daten gezielt zu synchronisieren, sodass keine Informationen verloren gehen und beide Systemkomponenten auf dem aktuellen Stand sind. 

Mögliche Änderungen auf Seite des Webservers:

* Neue Einträge in die Tabelle Pilot (neuen Pilot anlegen)
* Modifizierte Einträge in der Tabelle Pilot (Pilotendaten modifizieren, Pilot deaktivieren, ...)
* Neue Einträge in die Tabelle Flugsession (Flüge nachtragen)
* Neue Einträge in die Tabelle RFID-Ausweis (RFID-Ausweis hinzufügen)

Mögliche Änderungen auf Seite des Terminals:

* Neue Einträge in die Tabelle Flugsession (An-/Abmeldung, Flugleiter bestimmen)

Das einzige "Konfliktpotenzial" bei der Synchronisierung besteht durch die Tabelle Flugsession, wenn Änderungen am Webserver und am Terminal vorliegen.
Außerdem ist zu beachten, dass der Webserver die Tabelle Gast und die Login-Daten nicht mit synchronisiert. 

=== Aufbau der REST-API
In der folgenden Übersicht sind alle URLs der REST-API aufgelistet, die von Webserver (Frontend & Backend) und Terminal benutzt werden, um Informationen und Befehle untereinander auszutauschen. Die Unterteilung der URLs erfolgt nach HTTP-Methode:

* GET - Anfordern von Daten
* POST - Übermitteln neuer Daten
* PUT - Verändern bestehender Daten
* DELETE - Löschen bestehender Daten

// Im Laufe der Entwicklung diesen Abschnitt um Screenshots von Swagger.io ergänzen

==== GET

[%header, cols="1,1,2,2"]
|===
| URL
| Beschreibung
| Attribute
| Start -> Ziel

| /pilots
| Erwarte alle Piloten der Tabelle Pilot
a|
* ?from=0?to=20 (die ersten 20)
* ?active=false (alle deaktiven)
* /id/2 (Pilot mit Id = 2)
a|
* Frontend -> Backend
* Terminal -> Backend

| /sessions
| Erwarte alle Sessions der Tabelle Flugsession
a|
* ?from=0?to=20 (die ersten 20)
* ?running=true (alle derzeitigen)
* /filterByTime?from=23.04.2021?to=25.04.2021
* /filterByPilot/2 (alle Sessions von Pilot 2)
* /filterById/5 (Session mit Id = 5)
a|
* Frontend -> Backend
* Terminal -> Backend

| /settings
| Erwarte alle Einstellungen für den Terminalablauf
a|
JSON
a|
* Frontend -> Backend
* Terminal -> Backend

|===

==== POST

[%header, cols="1,1,2,2"]
|===
| URL
| Beschreibung
| Attribute
| Start -> Ziel

| /pilots
| Hinzufügen eines neuen Piloten zur Tabelle Pilot
a|
* "name": "Mustermann",
* "rfid": "24572"
* ...
a|
* Frontend -> Backend

| /sessions (alterntaiv: /sessions/check_in)
| Hinzufügen einer neuen Session
a|
* "pilot_id": "3",
* "start_time": "23.06.2021 15:43:12"
* ...
a|
* Terminal -> Backend
// Return Session Id?

| /ping
| Sende "Lebenszeichen" des Terminals
a|
a|
* Terminal -> Backend
|===

==== PUT

[%header, cols="1,1,2,2"]
|===
| URL
| Beschreibung
| Attribute
| Start -> Ziel

| /pilots
| Ändern eines Piloten in der Tabelle Pilot
a|
* /id/2 (ID des Piloten)
* ?active=false
* "rfid": "24572"
a|
* Frontend -> Backend

| /sessions/check_out
| Beenden einer Session oder aller Sessions
a|
* "session_id": "18",
* "end_time": "23.06.2021 17:09:12"
* ...
* ?all
a|
* Terminal -> Backend
* Frontend -> Backend
* Backend -> Terminal

| /sessions/flags
| Flugleiter bestimmen, Gast hinzufügen
a|
* ?leader
* "session_id": "18",
* ?guest
* "guest_name": "Max Muster",
* "guest_info": "..."
a|
* Terminal -> Backend
* Frontend -> Backend

| /settings
| Ändere Einstellungen für den Terminalablauf
a|
JSON
a|
* Frontend -> Backend
|===

==== DELETE

[%header, cols="1,1,2,2"]
|===
| URL
| Beschreibung
| Attribute
| Start -> Ziel

| /pilots
| Löschen eines Piloten aus der Tabelle Pilot
a|
* /id/2 (ID des Piloten)
a|
* Frontend -> Backend
|===


== Graphische Designaspekte
Garphische Designaspekte beschreiben Entwurfsentscheidungen, die direkten Einfluss auf die Darstellungsweise einzelner Systemkomponenten für den Benutzer haben.

Das System unterscheidet sich in zwei physisch getrennte Bereiche:

[#terminal_states]

=== Terminal

In der folgenden Übersicht sind die verschiedenen Bedienungsmöglichkeiten am Terminal vor Ort sowie die Reaktion des Systems in Form einer RGB-LED angegeben. Der Button ist ein dort platzierter Druckknopf und die Karte der RFID-Ausweis eines Piloten. Des Weiteren sind am unteren Ende der Grafik die Zustände der LED während der Nicht-Benutzung des Terminals dargestellt:

.Statusmeldungen/Bedienungsanleitung am Terminal
image::Statusmeldungen.png[Statusmeldungen Terminal, width=60%, align="center"]

=== Webserver

==== Wireframe

Großteilig sind die Wireframes in den dazu passenden Use-Cases eingefügt. Sämtliche Wireframes sind zudem unter https://github.com/simonherbstrith/E2-Anwesenheitserfassung-fuer-Modellflugplatz/tree/master/docs/requirements/images/Wireframes zu finden.

Weitere Festlegungen zur Darstellung und Bedienung der Website:

* Die Protokolldaten werden als Liste im Reiter "Protokoll" dargestellt. Eine Zeile des Protokolls bildet dabei eine Flugsession eines Piloten ab.
* Als Bestätigung zur Ausführung von essentiellen Funktionen wird ein Bestätigungs-Fenster entwickelt. Dies erscheint beispielsweise beim Deaktivieren von Piloten und ist entweder mit "Ja" (Ausführung) oder "Nein" (Abbruch) zu beantworten.

Für eine Übersicht der verschiedenen Wireframes und deren Beziehungen wurde folgendes Diagramm erstellt:

.Verlinkung/Zusammenhänge zwischen Wireframes
image::wireframe_overview.png[Übersicht Wireframes, width=70%, align="center"]

Das Wireframe "Startseite Admin" ist nicht in Use-Cases platziert und wird deshalb im Folgenden erläutert. Aus diesem Wireframe lässt sich ebenso das Wireframe "Startseite" für Nicht-Admins ableiten, bei welchem lediglich die Admin- sowie der Pilotenbereiche nicht vorhanden sind (siehe Startseite bei Wireframes). Beide Seiten sind nur durch einen Login mit Nutzername und Passwort erreichbar (siehe Login-Seite bei Wireframes).

Im oberen Teil des Wireframes "Startseite Admin" sind die aktuell aktiven Piloten sichtbar. Dies ist aus folgenden Gründen relevant:

* Bin ich als momentan aktiv eingetragen? (z.B. bei Unsicherheit, ob die An-/Abmeldung funktioniert hat)
* Ist noch ein weiterer Pilot aktiv? (z.B. falls letzte Person vor Ort -> alle Piloten abmelden (UC06))
* Wie viele Piloten sind momentan aktiv? (da ab 3 Piloten ein Flugleiter notwendig ist (UC07))

Unterhalb dieses Bereiches sind weitere Funktionalitäten für angemeldete Admins verfügbar.


.Wireframe: Login
image::Login_V3.png[Startseite Admin, width=70%, align="center"]

.Wireframe: Startseite (Admin), zeigt aktuell aktive Piloten auf dem Flugplatz
image::Startseite_Admin_V3.png[Startseite Admin, width=70%, align="center"]

.Wireframe: Startseite (Admin), zeigt aktuell aktive Piloten auf dem Flugplatz
image::Startseite_Admin_V3.png[Startseite Admin, width=70%, align="center"]

.Wireframe: Startseite (Mitglied), zeigt aktuell aktive Piloten auf dem Flugplatz
image::Startseite_Mitglied_V3.png[Startseite Admin, width=70%, align="center"]

